var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function o(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function c(t){return document.createTextNode(t)}function h(){return c(" ")}function f(){return c("")}function p(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function d(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function y(t,e){t.value=null==e?"":e}function b(t,e,n){t.classList[n?"add":"remove"](e)}class v{constructor(){this.e=this.n=null}c(t){this.h(t)}m(t,e,n=null){this.e||(this.e=u(e.nodeName),this.t=e,this.c(t)),this.i(n)}h(t){this.e.innerHTML=t,this.n=Array.from(this.e.childNodes)}i(t){for(let e=0;e<this.n.length;e+=1)l(this.t,this.n[e],t)}p(t){this.d(),this.h(t),this.i(this.a)}d(){this.n.forEach(a)}}let g;function $(t){g=t}const w=[],x=[],k=[],_=[],E=Promise.resolve();let S=!1;function O(t){k.push(t)}const j=new Set;let T=0;function A(){const t=g;do{for(;T<w.length;){const t=w[T];T++,$(t),C(t.$$)}for($(null),w.length=0,T=0;x.length;)x.pop()();for(let t=0;t<k.length;t+=1){const e=k[t];j.has(e)||(j.add(e),e())}k.length=0}while(w.length);for(;_.length;)_.pop()();S=!1,j.clear(),$(t)}function C(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(O)}}const P=new Set;let N;function I(){N={r:0,c:[],p:N}}function R(){N.r||r(N.c),N=N.p}function B(t,e){t&&t.i&&(P.delete(t),t.i(e))}function q(t,e,n,r){if(t&&t.o){if(P.has(t))return;P.add(t),N.c.push((()=>{P.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function L(t){t&&t.c()}function M(t,n,s,i){const{fragment:l,on_mount:a,on_destroy:u,after_update:c}=t.$$;l&&l.m(n,s),i||O((()=>{const n=a.map(e).filter(o);u?u.push(...n):r(n),t.$$.on_mount=[]})),c.forEach(O)}function F(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function G(t,e){-1===t.$$.dirty[0]&&(w.push(t),S||(S=!0,E.then(A)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(e,o,s,i,l,u,c,h=[-1]){const f=g;$(e);const p=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(f?f.$$.context:[])),callbacks:n(),dirty:h,skip_bound:!1,root:o.target||f.$$.root};c&&c(p.root);let d=!1;if(p.ctx=s?s(e,o.props||{},((t,n,...r)=>{const o=r.length?r[0]:n;return p.ctx&&l(p.ctx[t],p.ctx[t]=o)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](o),d&&G(e,t)),n})):[],p.update(),d=!0,r(p.before_update),p.fragment=!!i&&i(p.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);p.fragment&&p.fragment.l(t),t.forEach(a)}else p.fragment&&p.fragment.c();o.intro&&B(e.$$.fragment),M(e,o.target,o.anchor,o.customElement),A()}$(f)}class J{$destroy(){F(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function H(e){let n,o,s,c,f,m,y,v,g,$,w,x;return{c(){n=u("nav"),o=u("div"),s=u("button"),s.textContent="File",c=h(),f=u("div"),m=u("button"),m.textContent="New",y=h(),v=u("button"),v.textContent="Open..",g=h(),$=u("button"),$.textContent="Save",d(s,"class","menu-top svelte-1m5xlh2"),d(m,"class","svelte-1m5xlh2"),d(v,"class","svelte-1m5xlh2"),d($,"class","svelte-1m5xlh2"),d(f,"class","menu-item-container svelte-1m5xlh2"),b(f,"hidden",e[3]),d(o,"class","menu-container svelte-1m5xlh2"),d(n,"class","menu svelte-1m5xlh2")},m(t,r){l(t,n,r),i(n,o),i(o,s),i(o,c),i(o,f),i(f,m),i(f,y),i(f,v),i(f,g),i(f,$),w||(x=[p(s,"click",e[4]),p(m,"click",e[5]),p(v,"click",e[6]),p($,"click",e[7])],w=!0)},p(t,[e]){8&e&&b(f,"hidden",t[3])},i:t,o:t,d(t){t&&a(n),w=!1,r(x)}}}function W(t,e,n){let{on_new:r=(()=>{})}=e,{on_open:o=(()=>{})}=e,{on_save:s=(()=>{})}=e,i=!0;return t.$$set=t=>{"on_new"in t&&n(0,r=t.on_new),"on_open"in t&&n(1,o=t.on_open),"on_save"in t&&n(2,s=t.on_save)},[r,o,s,i,()=>{n(3,i=!i)},()=>{n(3,i=!0),r()},()=>{n(3,i=!0),o()},()=>{n(3,i=!0),s()}]}class U extends J{constructor(t){super(),D(this,t,W,H,s,{on_new:0,on_open:1,on_save:2})}}function z(t){let e,n;return{c(){e=c("- "),n=c(t[0])},m(t,r){l(t,e,r),l(t,n,r)},p(t,e){1&e&&m(n,t[0])},d(t){t&&a(e),t&&a(n)}}}function V(t){let e,n,r,o,s,f,p=t[0].length>0&&z(t);return s=new U({props:{on_new:t[1],on_open:t[2],on_save:t[3]}}),{c(){e=u("nav"),n=u("div"),r=c("ChordPro Editor\n        "),p&&p.c(),o=h(),L(s.$$.fragment),d(n,"class","title svelte-13svjsv"),d(e,"class","no-print svelte-13svjsv")},m(t,a){l(t,e,a),i(e,n),i(n,r),p&&p.m(n,null),i(e,o),M(s,e,null),f=!0},p(t,[e]){t[0].length>0?p?p.p(t,e):(p=z(t),p.c(),p.m(n,null)):p&&(p.d(1),p=null);const r={};2&e&&(r.on_new=t[1]),4&e&&(r.on_open=t[2]),8&e&&(r.on_save=t[3]),s.$set(r)},i(t){f||(B(s.$$.fragment,t),f=!0)},o(t){q(s.$$.fragment,t),f=!1},d(t){t&&a(e),p&&p.d(),F(s)}}}function K(t,e,n){let{subtitle:r=""}=e,{on_new:o=(()=>{})}=e,{on_open:s=(()=>{})}=e,{on_save:i=(()=>{})}=e;return t.$$set=t=>{"subtitle"in t&&n(0,r=t.subtitle),"on_new"in t&&n(1,o=t.on_new),"on_open"in t&&n(2,s=t.on_open),"on_save"in t&&n(3,i=t.on_save)},[r,o,s,i]}class Q extends J{constructor(t){super(),D(this,t,K,V,s,{subtitle:0,on_new:1,on_open:2,on_save:3})}}var X="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Y(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Z,tt=Y((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n,r,o,s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==X?X:"undefined"!=typeof self?self:{},i={},l={exports:{}};r=s,o=function(){function t(e,n,r){return this.id=++t.highestId,this.name=e,this.symbols=n,this.postprocess=r,this}function e(t,e,n,r){this.rule=t,this.dot=e,this.reference=n,this.data=[],this.wantedBy=r,this.isComplete=this.dot===t.symbols.length}function n(t,e){this.grammar=t,this.index=e,this.states=[],this.wants={},this.scannable=[],this.completed={}}function r(t,e){this.rules=t,this.start=e||this.rules[0].name;var n=this.byName={};this.rules.forEach((function(t){n.hasOwnProperty(t.name)||(n[t.name]=[]),n[t.name].push(t)}))}function o(){this.reset("")}function s(t,e,s){if(t instanceof r){var i=t;s=e}else i=r.fromCompiled(t,e);for(var l in this.grammar=i,this.options={keepHistory:!1,lexer:i.lexer||new o},s||{})this.options[l]=s[l];this.lexer=this.options.lexer,this.lexerState=void 0;var a=new n(i,0);this.table=[a],a.wants[i.start]=[],a.predict(i.start),a.process(),this.current=0}function i(t){var e=typeof t;if("string"===e)return t;if("object"===e){if(t.literal)return JSON.stringify(t.literal);if(t instanceof RegExp)return t.toString();if(t.type)return"%"+t.type;if(t.test)return"<"+String(t.test)+">";throw new Error("Unknown symbol type: "+t)}}return t.highestId=0,t.prototype.toString=function(t){var e=void 0===t?this.symbols.map(i).join(" "):this.symbols.slice(0,t).map(i).join(" ")+" ● "+this.symbols.slice(t).map(i).join(" ");return this.name+" → "+e},e.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},e.prototype.nextState=function(t){var n=new e(this.rule,this.dot+1,this.reference,this.wantedBy);return n.left=this,n.right=t,n.isComplete&&(n.data=n.build(),n.right=void 0),n},e.prototype.build=function(){var t=[],e=this;do{t.push(e.right.data),e=e.left}while(e.left);return t.reverse(),t},e.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,s.fail))},n.prototype.process=function(t){for(var e=this.states,n=this.wants,r=this.completed,o=0;o<e.length;o++){var i=e[o];if(i.isComplete){if(i.finish(),i.data!==s.fail){for(var l=i.wantedBy,a=l.length;a--;){var u=l[a];this.complete(u,i)}if(i.reference===this.index){var c=i.rule.name;(this.completed[c]=this.completed[c]||[]).push(i)}}}else{if("string"!=typeof(c=i.rule.symbols[i.dot])){this.scannable.push(i);continue}if(n[c]){if(n[c].push(i),r.hasOwnProperty(c)){var h=r[c];for(a=0;a<h.length;a++){var f=h[a];this.complete(i,f)}}}else n[c]=[i],this.predict(c)}}},n.prototype.predict=function(t){for(var n=this.grammar.byName[t]||[],r=0;r<n.length;r++){var o=n[r],s=this.wants[t],i=new e(o,0,this.index,s);this.states.push(i)}},n.prototype.complete=function(t,e){var n=t.nextState(e);this.states.push(n)},r.fromCompiled=function(e,n){var o=e.Lexer;e.ParserStart&&(n=e.ParserStart,e=e.ParserRules);var s=new r(e=e.map((function(e){return new t(e.name,e.symbols,e.postprocess)})),n);return s.lexer=o,s},o.prototype.reset=function(t,e){this.buffer=t,this.index=0,this.line=e?e.line:1,this.lastLineBreak=e?-e.col:0},o.prototype.next=function(){if(this.index<this.buffer.length){var t=this.buffer[this.index++];return"\n"===t&&(this.line+=1,this.lastLineBreak=this.index),{value:t}}},o.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},o.prototype.formatError=function(t,e){var n=this.buffer;if("string"==typeof n){var r=n.split("\n").slice(Math.max(0,this.line-5),this.line);n.indexOf("\n",this.index);var o=this.index-this.lastLineBreak,s=String(this.line).length;return e+=" at line "+this.line+" col "+o+":\n\n",e+=r.map((function(t,e){return i(this.line-r.length+e+1,s)+" "+t}),this).join("\n"),e+"\n"+i("",s+o)+"^\n"}return e+" at index "+(this.index-1);function i(t,e){var n=String(t);return Array(e-n.length+1).join(" ")+n}},s.fail={},s.prototype.feed=function(t){var e,r=this.lexer;for(r.reset(t,this.lexerState);;){try{if(!(e=r.next()))break}catch(t){var s=new n(this.grammar,this.current+1);throw this.table.push(s),(a=new Error(this.reportLexerError(t))).offset=this.current,a.token=t.token,a}var i=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var l=this.current+1;s=new n(this.grammar,l),this.table.push(s);for(var a,u=void 0!==e.text?e.text:e.value,c=r.constructor===o?e.value:e,h=i.scannable,f=h.length;f--;){var p=h[f],d=p.rule.symbols[p.dot];if(d.test?d.test(c):d.type?d.type===e.type:d.literal===u){var m=p.nextState({data:c,token:e,isToken:!0,reference:l-1});s.states.push(m)}}if(s.process(),0===s.states.length)throw(a=new Error(this.reportError(e))).offset=this.current,a.token=e,a;this.options.keepHistory&&(i.lexerState=r.save()),this.current++}return i&&(this.lexerState=r.save()),this.results=this.finish(),this},s.prototype.reportLexerError=function(t){var e,n,r=t.token;return r?(e="input "+JSON.stringify(r.text[0])+" (lexer error)",n=this.lexer.formatError(r,"Syntax error")):(e="input (lexer error)",n=t.message),this.reportErrorCommon(n,e)},s.prototype.reportError=function(t){var e=(t.type?t.type+" token: ":"")+JSON.stringify(void 0!==t.value?t.value:t),n=this.lexer.formatError(t,"Syntax error");return this.reportErrorCommon(n,e)},s.prototype.reportErrorCommon=function(t,e){var n=[];n.push(t);var r=this.table.length-2,o=this.table[r],s=o.states.filter((function(t){var e=t.rule.symbols[t.dot];return e&&"string"!=typeof e}));return 0===s.length?(n.push("Unexpected "+e+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(o.states,n)):(n.push("Unexpected "+e+". Instead, I was expecting to see one of the following:\n"),s.map((function(t){return this.buildFirstStateStack(t,[])||[t]}),this).forEach((function(t){var e=t[0],r=e.rule.symbols[e.dot],o=this.getSymbolDisplay(r);n.push("A "+o+" based on:"),this.displayStateStack(t,n)}),this)),n.push(""),n.join("\n")},s.prototype.displayStateStack=function(t,e){for(var n,r=0,o=0;o<t.length;o++){var s=t[o],i=s.rule.toString(s.dot);i===n?r++:(r>0&&e.push("    ^ "+r+" more lines identical to this"),r=0,e.push("    "+i)),n=i}},s.prototype.getSymbolDisplay=function(t){return function(t){var e=typeof t;if("string"===e)return t;if("object"===e){if(t.literal)return JSON.stringify(t.literal);if(t instanceof RegExp)return"character matching "+t;if(t.type)return t.type+" token";if(t.test)return"token matching "+String(t.test);throw new Error("Unknown symbol type: "+t)}}(t)},s.prototype.buildFirstStateStack=function(t,e){if(-1!==e.indexOf(t))return null;if(0===t.wantedBy.length)return[t];var n=t.wantedBy[0],r=[t].concat(e),o=this.buildFirstStateStack(n,r);return null===o?null:[t].concat(o)},s.prototype.save=function(){var t=this.table[this.current];return t.lexerState=this.lexerState,t},s.prototype.restore=function(t){var e=t.index;this.current=e,this.table[e]=t,this.table.splice(e+1),this.lexerState=t.lexerState,this.results=this.finish()},s.prototype.rewind=function(t){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[t])},s.prototype.finish=function(){var t=[],e=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(n){n.rule.name===e&&n.dot===n.rule.symbols.length&&0===n.reference&&n.data!==s.fail&&t.push(n)})),t.map((function(t){return t.data}))},{Parser:s,Grammar:r,Rule:t}},(n=l).exports?n.exports=o():r.nearley=o();var a=l.exports,u={exports:{}},c={exports:{}};!function(t){!function(e,n){t.exports?t.exports=n():e.moo=n()}(s,(function(){var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,n="boolean"==typeof(new RegExp).sticky;function r(t){return t&&"[object RegExp]"===e.call(t)}function o(t){return t&&"object"==typeof t&&!r(t)&&!Array.isArray(t)}function s(t){return"("+t+")"}function i(t){return t.length?"(?:"+t.map((function(t){return"(?:"+t+")"})).join("|")+")":"(?!)"}function l(t){if("string"==typeof t)return"(?:"+t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(r(t)){if(t.ignoreCase)throw new Error("RegExp /i flag not allowed");if(t.global)throw new Error("RegExp /g flag is implied");if(t.sticky)throw new Error("RegExp /y flag is implied");if(t.multiline)throw new Error("RegExp /m flag is implied");return t.source}throw new Error("Not a pattern: "+t)}function a(e,n){if(o(n)||(n={match:n}),n.include)throw new Error("Matching rules cannot also include states");var s={defaultType:e,lineBreaks:!!n.error||!!n.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var i in n)t.call(n,i)&&(s[i]=n[i]);if("string"==typeof s.type&&e!==s.type)throw new Error("Type transform cannot be a string (type '"+s.type+"' for token '"+e+"')");var l=s.match;return s.match=Array.isArray(l)?l:l?[l]:[],s.match.sort((function(t,e){return r(t)&&r(e)?0:r(e)?-1:r(t)?1:e.length-t.length})),s}function u(t){return Array.isArray(t)?function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];if(r.include)for(var o=[].concat(r.include),s=0;s<o.length;s++)e.push({include:o[s]});else{if(!r.type)throw new Error("Rule has no type: "+JSON.stringify(r));e.push(a(r.type,r))}}return e}(t):function(t){for(var e=Object.getOwnPropertyNames(t),n=[],r=0;r<e.length;r++){var s=e[r],i=t[s],l=[].concat(i);if("include"!==s){var u=[];l.forEach((function(t){o(t)?(u.length&&n.push(a(s,u)),n.push(a(s,t)),u=[]):u.push(t)})),u.length&&n.push(a(s,u))}else for(var c=0;c<l.length;c++)n.push({include:l[c]})}return n}(t)}var c=a("error",{lineBreaks:!0,shouldThrow:!0});function h(t,e){for(var o=null,a=Object.create(null),u=!0,h=null,f=[],p=[],d=0;d<t.length;d++)t[d].fallback&&(u=!1);for(d=0;d<t.length;d++){var m=t[d];if(m.include)throw new Error("Inheritance is not allowed in stateless lexers");if(m.error||m.fallback){if(o)throw!m.fallback==!o.fallback?new Error("Multiple "+(m.fallback?"fallback":"error")+" rules not allowed (for token '"+m.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+m.defaultType+"')");o=m}var y=m.match.slice();if(u)for(;y.length&&"string"==typeof y[0]&&1===y[0].length;)a[y.shift().charCodeAt(0)]=m;if(m.pop||m.push||m.next){if(!e)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+m.defaultType+"')");if(m.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+m.defaultType+"')")}if(0!==y.length){u=!1,f.push(m);for(var b=0;b<y.length;b++){var v=y[b];if(r(v))if(null===h)h=v.unicode;else if(h!==v.unicode&&!1===m.fallback)throw new Error("If one rule is /u then all must be")}var g=i(y.map(l)),$=new RegExp(g);if($.test(""))throw new Error("RegExp matches empty string: "+$);if(new RegExp("|"+g).exec("").length-1>0)throw new Error("RegExp has capture groups: "+$+"\nUse (?: … ) instead");if(!m.lineBreaks&&$.test("\n"))throw new Error("Rule should declare lineBreaks: "+$);p.push(s(g))}}var w=o&&o.fallback,x=n&&!w?"ym":"gm",k=n||w?"":"|";return!0===h&&(x+="u"),{regexp:new RegExp(i(p)+k,x),groups:f,fast:a,error:o||c}}function f(t,e,n){var r=t&&(t.push||t.next);if(r&&!n[r])throw new Error("Missing state '"+r+"' (in token '"+t.defaultType+"' of state '"+e+"')");if(t&&t.pop&&1!=+t.pop)throw new Error("pop must be 1 (in token '"+t.defaultType+"' of state '"+e+"')")}var p=function(t,e){this.startState=e,this.states=t,this.buffer="",this.stack=[],this.reset()};p.prototype.reset=function(t,e){return this.buffer=t||"",this.index=0,this.line=e?e.line:1,this.col=e?e.col:1,this.queuedToken=e?e.queuedToken:null,this.queuedThrow=e?e.queuedThrow:null,this.setState(e?e.state:this.startState),this.stack=e&&e.stack?e.stack.slice():[],this},p.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},p.prototype.setState=function(t){if(t&&this.state!==t){this.state=t;var e=this.states[t];this.groups=e.groups,this.error=e.error,this.re=e.regexp,this.fast=e.fast}},p.prototype.popState=function(){this.setState(this.stack.pop())},p.prototype.pushState=function(t){this.stack.push(this.state),this.setState(t)};var d=n?function(t,e){return t.exec(e)}:function(t,e){var n=t.exec(e);return 0===n[0].length?null:n};function m(){return this.value}if(p.prototype._getGroup=function(t){for(var e=this.groups.length,n=0;n<e;n++)if(void 0!==t[n+1])return this.groups[n];throw new Error("Cannot find token type for matched text")},p.prototype.next=function(){var t=this.index;if(this.queuedGroup){var e=this._token(this.queuedGroup,this.queuedText,t);return this.queuedGroup=null,this.queuedText="",e}var n=this.buffer;if(t!==n.length){if(i=this.fast[n.charCodeAt(t)])return this._token(i,n.charAt(t),t);var r=this.re;r.lastIndex=t;var o=d(r,n),s=this.error;if(null==o)return this._token(s,n.slice(t,n.length),t);var i=this._getGroup(o),l=o[0];return s.fallback&&o.index!==t?(this.queuedGroup=i,this.queuedText=l,this._token(s,n.slice(t,o.index),t)):this._token(i,l,t)}},p.prototype._token=function(t,e,n){var r=0;if(t.lineBreaks){var o=/\n/g,s=1;if("\n"===e)r=1;else for(;o.exec(e);)r++,s=o.lastIndex}var i={type:"function"==typeof t.type&&t.type(e)||t.defaultType,value:"function"==typeof t.value?t.value(e):e,text:e,toString:m,offset:n,lineBreaks:r,line:this.line,col:this.col},l=e.length;if(this.index+=l,this.line+=r,0!==r?this.col=l-s+1:this.col+=l,t.shouldThrow)throw new Error(this.formatError(i,"invalid syntax"));return t.pop?this.popState():t.push?this.pushState(t.push):t.next&&this.setState(t.next),i},"undefined"!=typeof Symbol&&Symbol.iterator){var y=function(t){this.lexer=t};y.prototype.next=function(){var t=this.lexer.next();return{value:t,done:!t}},y.prototype[Symbol.iterator]=function(){return this},p.prototype[Symbol.iterator]=function(){return new y(this)}}return p.prototype.formatError=function(t,e){if(null==t){var n=this.buffer.slice(this.index);t={text:n,offset:this.index,lineBreaks:-1===n.indexOf("\n")?0:1,line:this.line,col:this.col}}var r=Math.max(0,t.offset-t.col+1),o=t.lineBreaks?t.text.indexOf("\n"):t.text.length,s=this.buffer.substring(r,t.offset+o);return e+=" at line "+t.line+" col "+t.col+":\n\n",(e+="  "+s+"\n")+"  "+Array(t.col).join(" ")+"^"},p.prototype.clone=function(){return new p(this.states,this.state)},p.prototype.has=function(t){return!0},{compile:function(t){var e=h(u(t));return new p({start:e},"start")},states:function(t,e){var n=t.$all?u(t.$all):[];delete t.$all;var r=Object.getOwnPropertyNames(t);e||(e=r[0]);for(var o=Object.create(null),s=0;s<r.length;s++)o[g=r[s]]=u(t[g]).concat(n);for(s=0;s<r.length;s++)for(var i=o[g=r[s]],l=Object.create(null),a=0;a<i.length;a++){var c=i[a];if(c.include){var d=[a,1];if(c.include!==g&&!l[c.include]){l[c.include]=!0;var m=o[c.include];if(!m)throw new Error("Cannot include nonexistent state '"+c.include+"' (in state '"+g+"')");for(var y=0;y<m.length;y++){var b=m[y];-1===i.indexOf(b)&&d.push(b)}}i.splice.apply(i,d),a--}}var v=Object.create(null);for(s=0;s<r.length;s++){var g;v[g=r[s]]=h(o[g],!0)}for(s=0;s<r.length;s++){var $=r[s],w=v[$],x=w.groups;for(a=0;a<x.length;a++)f(x[a],$,v);var k=Object.getOwnPropertyNames(w.fast);for(a=0;a<k.length;a++)f(w.fast[k[a]],$,v)}return new p(v,e)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(t){for(var e=Object.create(null),n=Object.create(null),r=Object.getOwnPropertyNames(t),o=0;o<r.length;o++){var s=r[o],i=t[s];(Array.isArray(i)?i:[i]).forEach((function(t){if((n[t.length]=n[t.length]||[]).push(t),"string"!=typeof t)throw new Error("keyword must be string (in keyword '"+s+"')");e[t]=s}))}function l(t){return JSON.stringify(t)}var a="";for(var u in a+="switch (value.length) {\n",n){var c=n[u];a+="case "+u+":\n",a+="switch (value) {\n",c.forEach((function(t){var n=e[t];a+="case "+l(t)+": return "+l(n)+"\n"})),a+="}\n"}return a+="}\n",Function("value",a)}}}))}(c),function(t){!function(){let e=c.exports.compile({title:{match:/(?:{title:.*?}|{t:.*?})/,value:t=>t.slice(1,-1).split(":")[1].trim()},subtitle:{match:/(?:{subtitle:.*?}|{st:.*?})/,value:t=>t.slice(1,-1).split(":")[1].trim()},artist:{match:/{artist:.*?}/,value:t=>t.slice(1,-1).split(":")[1].trim()},chord:{match:/\[.+?\]/,value:t=>t.slice(1,-1)},nl:{match:/\n/,lineBreaks:!0},soc:/(?:{soc}|{start_of_chorus})/,eoc:/(?:{eoc}|{end_of_chorus})/,text:/[^[\n]+/});var n={Lexer:e,ParserRules:[{name:"chordpro",symbols:["header","content"],postprocess:function(t){var e={type:"chordpro",header:[],content:[]};return e.header=t[0],e.content=t[1],e}},{name:"header$ebnf$1",symbols:[]},{name:"header$ebnf$1",symbols:["header$ebnf$1",e.has("nl")?{type:"nl"}:nl],postprocess:function(t){return t[0].concat([t[1]])}},{name:"header",symbols:["title","subtitle","artist","header$ebnf$1"],postprocess:function(t){return{type:"header",title:t[0],subtitle:t[1],artist:t[2]}}},{name:"title",symbols:[]},{name:"title",symbols:[e.has("title")?{type:"title"}:title,e.has("nl")?{type:"nl"}:nl],postprocess:function(t){return t[0].value}},{name:"subtitle",symbols:[]},{name:"subtitle",symbols:[e.has("subtitle")?{type:"subtitle"}:subtitle,e.has("nl")?{type:"nl"}:nl],postprocess:function(t){return t[0].value}},{name:"artist",symbols:[]},{name:"artist",symbols:[e.has("artist")?{type:"artist"}:artist,e.has("nl")?{type:"nl"}:nl],postprocess:function(t){return t[0].value}},{name:"content$ebnf$1",symbols:[]},{name:"content$ebnf$1$subexpression$1",symbols:["verse"]},{name:"content$ebnf$1$subexpression$1",symbols:["chorus"]},{name:"content$ebnf$1",symbols:["content$ebnf$1","content$ebnf$1$subexpression$1"],postprocess:function(t){return t[0].concat([t[1]])}},{name:"content",symbols:["content$ebnf$1"],postprocess:function(t){var e={type:"content",parts:[]};for(let n=0;n<t[0].length;n++)e.parts.push(t[0][n][0]);return e}},{name:"verse$ebnf$1",symbols:["line"]},{name:"verse$ebnf$1",symbols:["verse$ebnf$1","line"],postprocess:function(t){return t[0].concat([t[1]])}},{name:"verse$ebnf$2",symbols:[e.has("nl")?{type:"nl"}:nl]},{name:"verse$ebnf$2",symbols:["verse$ebnf$2",e.has("nl")?{type:"nl"}:nl],postprocess:function(t){return t[0].concat([t[1]])}},{name:"verse",symbols:["verse$ebnf$1","verse$ebnf$2"],postprocess:function(t){var e={type:"verse",lines:[]};for(let n=0;n<t[0].length;n++)e.lines.push(t[0][n]);return e}},{name:"chorus$ebnf$1",symbols:["line"]},{name:"chorus$ebnf$1",symbols:["chorus$ebnf$1","line"],postprocess:function(t){return t[0].concat([t[1]])}},{name:"chorus$ebnf$2",symbols:[e.has("nl")?{type:"nl"}:nl]},{name:"chorus$ebnf$2",symbols:["chorus$ebnf$2",e.has("nl")?{type:"nl"}:nl],postprocess:function(t){return t[0].concat([t[1]])}},{name:"chorus",symbols:[e.has("soc")?{type:"soc"}:soc,e.has("nl")?{type:"nl"}:nl,"chorus$ebnf$1",e.has("eoc")?{type:"eoc"}:eoc,"chorus$ebnf$2"],postprocess:function(t){var e={type:"chorus",lines:[]};for(let n=0;n<t[2].length;n++)e.lines.push(t[2][n]);return e}},{name:"line$ebnf$1$subexpression$1",symbols:[e.has("chord")?{type:"chord"}:chord]},{name:"line$ebnf$1$subexpression$1",symbols:[e.has("text")?{type:"text"}:text]},{name:"line$ebnf$1",symbols:["line$ebnf$1$subexpression$1"]},{name:"line$ebnf$1$subexpression$2",symbols:[e.has("chord")?{type:"chord"}:chord]},{name:"line$ebnf$1$subexpression$2",symbols:[e.has("text")?{type:"text"}:text]},{name:"line$ebnf$1",symbols:["line$ebnf$1","line$ebnf$1$subexpression$2"],postprocess:function(t){return t[0].concat([t[1]])}},{name:"line",symbols:["line$ebnf$1",e.has("nl")?{type:"nl"}:nl],postprocess:function(t){var e={type:"row",children:[]};for(let n=0;n<t[0].length;n++){let r=t[0][n][0];e.children.push({type:r.type,value:r.value})}return e}}],ParserStart:"chordpro"};t.exports=n}()}(u);var h=u.exports,f=function(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}(Object.freeze({__proto__:null,parse:function(t){const e=new a.Parser(a.Grammar.fromCompiled(h));return e.feed(t+"\n"),e.results[0]}})),p={process_row:function(t){let e="",n="";for(let r=0;r<t.children.length;r++){const o=t.children[r],s=Math.max(o.chord.length,o.text.length);e+=o.chord+" ".repeat(s-o.chord.length),n+=o.text+" ".repeat(s-o.text.length)}let r="";return e.length>0&&(r+=e+"\n"),r+n},process_verse:function(t){var e="";for(let n=0;n<t.children.length;n++){const r=t.children[n];r instanceof chordpro.NodeRow&&(e+=processRow(r)+"\n")}return e},process_song:function(t){var e="";t.title&&(e+=`Title: ${t.title}\n`),t.subTitle&&(e+=`Subtitle: ${t.subTitle}\n`),t.artist&&(e+=`Artist: ${t.artist}\n`),e+="\n";for(let n=0;n<t.body.length;n++){let r=t.body[n];r instanceof chordpro.NodeVerse&&(e+=process_verse(r))}return e}},d={};function m(t){let e=[],n=[],r=null;for(let o=0;o<t.children.length;o++){let s=t.children[o];"chord"===s.type?(e.push(s.value),r=s.value):"text"===s.type&&(null===r&&e.push(""),n.push(s.value),r=null)}let o='<table class="jschordpro-row">';return e.filter((t=>""!==t)).length>0&&(o+="<tr>",o+=e.map((t=>`<td class="jschordpro-chord">${t}</td>`)).join("\n"),o+="</tr>"),o+="<tr>",o+=n.map((t=>`<td class="jschordpro-lyrics">${t.replaceAll(" ","&nbsp;")}</td>`)).join("\n"),o+="</tr>",o+="</table>",o}function y(t){let e=`<div class="jschordpro-${t.type}">`;for(let n=0;n<t.lines.length;n++){let r=t.lines[n];"row"==r.type&&(e+=m(r))}return e+="</div>",e}d.process_song=function(t){var e='<div class="jschordpro-song">';if("chordpro"===t.type&&(t.header.title&&(e+=`<h1>${t.header.title}</h1>`),t.header.subtitle&&(e+=`<h2>${t.header.subtitle}</h2>`),t.header.artist&&(e+=`<h2>${t.header.artist}</h2>`),"content"===t.content.type))for(let n=0;n<t.content.parts.length;n++)e+=y(t.content.parts[n]);return e+"</div>"};const b=f,v=p,g=d;var $=i.parse=b.parse,w=i.to_ascii=v.process_song,x=i.to_html=g.process_song;e.default=i,e.parse=$,e.to_ascii=w,e.to_html=x}(Z={exports:{}},Z.exports),Z.exports));function et(t,e,n){const r=t.slice();return r[1]=e[n],r}function nt(t){let e,n,r,o,s,f,y,v=t[2].length>0&&t[4]&&rt(t);return{c(){e=u("div"),n=c(t[3]),r=h(),o=u("ul"),v&&v.c(),d(e,"class","label svelte-n859lx"),b(e,"expanded",t[4]),b(e,"collapsed",!t[4]),d(o,"class","svelte-n859lx")},m(a,u){l(a,e,u),i(e,n),l(a,r,u),l(a,o,u),v&&v.m(o,null),s=!0,f||(y=p(e,"click",t[5]),f=!0)},p(t,r){(!s||8&r)&&m(n,t[3]),16&r&&b(e,"expanded",t[4]),16&r&&b(e,"collapsed",!t[4]),t[2].length>0&&t[4]?v?(v.p(t,r),20&r&&B(v,1)):(v=rt(t),v.c(),B(v,1),v.m(o,null)):v&&(I(),q(v,1,1,(()=>{v=null})),R())},i(t){s||(B(v),s=!0)},o(t){q(v),s=!1},d(t){t&&a(e),t&&a(r),t&&a(o),v&&v.d(),f=!1,y()}}}function rt(t){let e,n,r=t[2],o=[];for(let e=0;e<r.length;e+=1)o[e]=ot(et(t,r,e));const s=t=>q(o[t],1,1,(()=>{o[t]=null}));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=f()},m(t,r){for(let e=0;e<o.length;e+=1)o[e].m(t,r);l(t,e,r),n=!0},p(t,n){if(5&n){let i;for(r=t[2],i=0;i<r.length;i+=1){const s=et(t,r,i);o[i]?(o[i].p(s,n),B(o[i],1)):(o[i]=ot(s),o[i].c(),B(o[i],1),o[i].m(e.parentNode,e))}for(I(),i=r.length;i<o.length;i+=1)s(i);R()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)B(o[t]);n=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)q(o[t]);n=!1},d(t){!function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(o,t),t&&a(e)}}}function ot(t){let e,n,r;return n=new lt({props:{root:t[1],level:t[0]+1}}),{c(){e=u("li"),L(n.$$.fragment)},m(t,o){l(t,e,o),M(n,e,null),r=!0},p(t,e){const r={};4&e&&(r.root=t[1]),1&e&&(r.level=t[0]+1),n.$set(r)},i(t){r||(B(n.$$.fragment,t),r=!0)},o(t){q(n.$$.fragment,t),r=!1},d(t){t&&a(e),F(n)}}}function st(t){let e,n,r=t[1]&&nt(t);return{c(){r&&r.c(),e=f()},m(t,o){r&&r.m(t,o),l(t,e,o),n=!0},p(t,[n]){t[1]?r?(r.p(t,n),2&n&&B(r,1)):(r=nt(t),r.c(),B(r,1),r.m(e.parentNode,e)):r&&(I(),q(r,1,1,(()=>{r=null})),R())},i(t){n||(B(r),n=!0)},o(t){q(r),n=!1},d(t){r&&r.d(t),t&&a(e)}}}function it(t,e,n){let{root:r=null}=e,{level:o=0}=e,s="",i=[],l=o<2;return t.$$set=t=>{"root"in t&&n(1,r=t.root),"level"in t&&n(0,o=t.level)},t.$$.update=()=>{6&t.$$.dirty&&null!==r&&(n(3,s=r.type),"chordpro"===r.type?n(2,i=[r.header,r.content]):"header"===r.type?(n(3,s="header: "),n(2,i=[{type:"leave",label:"title",value:r.title},{type:"leave",label:"subtitle",value:r.subtitle},{type:"leave",label:"artist",value:r.artist}])):"content"===r.type?n(2,i=r.parts):"verse"===r.type||"chorus"===r.type?n(2,i=r.lines):"row"===r.type?n(2,i=r.children):"chord"===r.type||"text"===r.type?n(3,s=r.type+": "+r.value):"leave"===r.type&&n(3,s=r.label+": "+r.value),0===i.length&&n(4,l=!0))},[o,r,i,s,l,()=>{0===i.length?n(4,l=!0):n(4,l=!l)}]}class lt extends J{constructor(t){super(),D(this,t,it,st,s,{root:1,level:0})}}function at(t){let e,n;return{c(){e=u("div"),n=c(t[1]),d(e,"class","error svelte-1n672im")},m(t,r){l(t,e,r),i(e,n)},p(t,e){2&e&&m(n,t[1])},d(t){t&&a(e)}}}function ut(t){let e,n,r;return n=new lt({props:{root:t[3]}}),{c(){e=u("div"),L(n.$$.fragment),d(e,"class","no-print tree svelte-1n672im")},m(t,o){l(t,e,o),M(n,e,null),r=!0},p(t,e){const r={};8&e&&(r.root=t[3]),n.$set(r)},i(t){r||(B(n.$$.fragment,t),r=!0)},o(t){q(n.$$.fragment,t),r=!1},d(t){t&&a(e),F(n)}}}function ct(t){let e,n,r,o,s,c,f,m,y,b,g=t[4](t[0])+"",$=null!==t[1]&&at(t),w=t[2]&&null!==t[3]&&ut(t);return{c(){e=u("div"),n=u("div"),r=u("button"),r.textContent="Tree",o=h(),$&&$.c(),s=h(),c=new v,f=h(),w&&w.c(),d(r,"class","svelte-1n672im"),d(n,"class","toolbar no-print svelte-1n672im"),c.a=f,d(e,"class","preview")},m(a,u){l(a,e,u),i(e,n),i(n,r),i(e,o),$&&$.m(e,null),i(e,s),c.m(g,e),i(e,f),w&&w.m(e,null),m=!0,y||(b=p(r,"click",t[5]),y=!0)},p(t,[n]){null!==t[1]?$?$.p(t,n):($=at(t),$.c(),$.m(e,s)):$&&($.d(1),$=null),(!m||1&n)&&g!==(g=t[4](t[0])+"")&&c.p(g),t[2]&&null!==t[3]?w?(w.p(t,n),12&n&&B(w,1)):(w=ut(t),w.c(),B(w,1),w.m(e,null)):w&&(I(),q(w,1,1,(()=>{w=null})),R())},i(t){m||(B(w),m=!0)},o(t){q(w),m=!1},d(t){t&&a(e),$&&$.d(),w&&w.d(),y=!1,b()}}}function ht(t,e,n){let{source:r=""}=e,o=null,s=!1,i=null;return t.$$set=t=>{"source"in t&&n(0,r=t.source)},[r,o,s,i,function(t){let e="";try{n(3,i=tt.parse(t+"\n")),e=tt.to_html(i),n(1,o=null)}catch(t){n(1,o=t.toString())}return e},()=>n(2,s=!s)]}class ft extends J{constructor(t){super(),D(this,t,ht,ct,s,{source:0})}}function pt(t){let e,n,o,s,c,f,m,b,v,g,$,w,x,k,_;return e=new Q({props:{subtitle:t[2]&&t[2].name,on_open:t[6],on_new:t[5],on_save:t[7]}}),g=new ft({props:{source:t[3]}}),{c(){var t,r,i;L(e.$$.fragment),n=h(),o=u("main"),s=u("div"),c=u("input"),f=h(),m=u("textarea"),b=h(),v=u("div"),L(g.$$.fragment),$=h(),w=u("footer"),w.textContent="Copyright 2021",t="display",r="none",c.style.setProperty(t,r,i?"important":""),d(c,"type","file"),d(c,"accept",".txt"),d(m,"class","no-print svelte-1953bfw"),d(s,"class","editor no-print svelte-1953bfw"),d(v,"class","preview svelte-1953bfw"),d(o,"class","svelte-1953bfw"),d(w,"class","svelte-1953bfw")},m(r,a){M(e,r,a),l(r,n,a),l(r,o,a),i(o,s),i(s,c),t[10](c),i(s,f),i(s,m),y(m,t[0]),i(o,b),i(o,v),M(g,v,null),l(r,$,a),l(r,w,a),x=!0,k||(_=[p(c,"change",t[9]),p(m,"input",t[11])],k=!0)},p(t,[n]){const r={};4&n&&(r.subtitle=t[2]&&t[2].name),e.$set(r),1&n&&y(m,t[0]);const o={};8&n&&(o.source=t[3]),g.$set(o)},i(t){x||(B(e.$$.fragment,t),B(g.$$.fragment,t),x=!0)},o(t){q(e.$$.fragment,t),q(g.$$.fragment,t),x=!1},d(s){F(e,s),s&&a(n),s&&a(o),t[10](null),F(g),s&&a($),s&&a(w),k=!1,r(_)}}}function dt(t,e,n){let r,o,{song:s=""}=e,i=s,l="";const a=function(t,e){let n;return function(){const r=this,o=arguments;clearTimeout(n),n=setTimeout((()=>t.apply(r,o)),e)}}((function(t){n(3,l=t)}),300);function u(t){let e=t.target.files[0],r=new FileReader;r.readAsText(e),r.onload=t=>{n(0,i=t.target.result)}}return t.$$set=t=>{"song"in t&&n(8,s=t.song)},t.$$.update=()=>{1&t.$$.dirty&&a(i)},[i,r,o,l,u,function(){console.log("new file"),n(0,i=""),n(3,l="")},async function(){n(2,o=await function(){if("showOpenFilePicker"in window){const t={types:[{description:"Chordpro",accept:{"text/plain":[".txt"]}}],excludeAcceptAllOption:!1,multiple:!1};return window.showOpenFilePicker(t).then((t=>t[0]))}return window.chooseFileSystemEntries({type:"open-file",accepts:[{description:"Chordpro text file",extensions:["txt"],mimeTypes:["text/plain"]}]})}()),console.log(o);try{let t=await o.getFile();n(0,i=await function(t){if(console.log("read_file",t),t.text)return console.log("returining text()"),t.text();{let e=new Promise((e=>{const n=new FileReader;n.addEventListener("loadend",(function(){console.log("loaded"),e(n.result)})),console.log("before readAsText",t),n.readAsText(t)}));return console.log("returining promise",e),e}}(t))}catch(t){console.error("read failed: ",t)}},async function(){if(o)try{await function(t,e){t.createWriter?t.createWriter().then((function(t){t.write(0,e).then((function(){return t.close()}))})):t.createWritable().then((function(t){t.write(e).then((function(){return t.close()}))}))}(o,i)}catch(t){const e="Unable to save file";console.error(e,t),alert(e)}},s,t=>u(t),function(t){x[t?"unshift":"push"]((()=>{r=t,n(1,r)}))},function(){i=this.value,n(0,i)}]}return new class extends J{constructor(t){super(),D(this,t,dt,pt,s,{song:8})}}({target:document.body,props:{song:"{title: In My Time of Dyin'}\n{subtitle: Bob Dylan}\n\n[Am]In my time of dying\n[Am]I don't want nobody to mourn\n[Am]All I want for you to do\nIs [D]take my body [Am]home\n\n{start_of_chorus}\n[Am]Well, well, well, so I can die easy\nWell, well, [D]well, so I can die [Am]easy\n[Am]Well, well, well, so I can die easy\n[D]Jesus gonna make up my [G]dy[G#]ing [Am]bed\n{end_of_chorus}\n\nWell, meet me Jesus, meet me\nMeet me in the middle of the air\nIf these wings should fail to me\nLord, won't you meet me with another pair\n\nLord, in my time of dying\nI don't want nobody to cry\nAll I want you to do\nIs take me when I die\n"}})}();
//# sourceMappingURL=bundle.js.map
